let QuestionsNumber,solvedQuestionsNumber=0;function Choice(e,t){this.id=e,this.text=t}function Question(e,t,n){this.id=e||"",this.text=t||"",this.choices=n||""}let currentQuestion=new Question,selectedChoiceID=null;function shuffle(e){var t,n,i;for(i=e.length-1;i>0;i--)t=Math.floor(Math.random()*(i+1)),n=e[i],e[i]=e[t],e[t]=n;return e}function updateProgressBar(){$("#progress-bar").width(100*parseFloat(solvedQuestionsNumber/QuestionsNumber)+"%"),$("#progress-bar-label").text(toPersianNum(solvedQuestionsNumber)+" از "+toPersianNum(QuestionsNumber)+" سوال ")}function updateQuestionCard(){document.getElementById("choicesDiv");$("#questionText").text(currentQuestion.text);let e=[];for(var t=0;t<currentQuestion.choices.length;t++){var n=document.createElement("button");n.setAttribute("id",`choice-${currentQuestion.choices[t].id}`),n.setAttribute("cid",currentQuestion.choices[t].id),n.setAttribute("class","choice"),n.setAttribute("type","button"),n.innerHTML=currentQuestion.choices[t].text,e=Array.prototype.concat(e,n)}$("#choicesDiv").html(e),selectedChoiceID=null}function submitAndGetNextQuestion(){$("#question-loading").removeClass("loaded"),$.ajax({url:"https://amirnaderi.ir/exammer/nextQuestion.php",type:"POST",data:{id:id,qID:currentQuestion.id,cID:selectedChoiceID},success:function(e){null!==selectedChoiceID&&(solvedQuestionsNumber++,updateProgressBar());let t=JSON.parse(e);if(2==t)document.getElementById("timerCaption").innerHTML="آزمون به پایان رسیده است",$.ajax({url:"https://amirnaderi.ir/exammer/getScore.php",type:"POST",data:{id:id},success:function(e){console.log(e);let t=parseInt(e.total||0),n=parseInt(e.correct||0),i=(parseInt(e.wrong||0),e.uid,0);i=parseFloat(n/t*20)||0,document.getElementById("timer").innerHTML=i,clearInterval(window.x)}}),$("#questionCard").children().animate({height:"hide"});else{console.log(e);let n=[];for(let e of t){let t=new Choice(e.CID,e.Choice);n=Array.prototype.concat(n,t)}shuffle(n),currentQuestion=new Question(t[0].QID,t[0].Question,n),updateQuestionCard(),setTimeout(()=>{$(document).scrollTop($("#timerRow").offset().top)},300),setTimeout(()=>{$("#question-loading").addClass("loaded")},350)}}})}function timeState(e,t){let n=window.now;return n<e?-1:n>e+t?1:0}let currentState=-1,lastState=-1;function handleUI(){if("0"==window.examInfo.success)document.getElementById("timer").innerHTML="شما دسترسی لازم برای مشاهده اطلاعات آزمون را ندارید",document.getElementById("timerCaption").innerHTML="خطا",clearInterval(window.x);else{let c=window.examInfo.beginningTime,d=window.examInfo.examDuration;if((currentState=timeState(c,d))!=lastState&&(-1==lastState&&0==currentState&&$(function(){$("#ex").animate({height:"hide"},500,function(){$(this).css({display:"none"})}),$("#progress-bar-container").removeClass("not-started"),document.getElementById("timerCaption").innerHTML="زمان باقی مانده",$("#questionCard").html('\n                                    <div class="col s12 m12">\n                                        <div class="card">\n                                            <div id="question-loading" class="loading-container">\n                                                <div class="spinner"></div>\n                                            </div>\n                                            <div class="card-content white-text">\n                                                <p class="content" id="questionText"></p>\n                                            </div>\n                                            <div class="card-action" id="choicesDiv">\n                                            </div>\n                                            <div class="card-action next-button-div">\n                                                <a id="next" onclick="submitAndGetNextQuestion()" class="waves-effect waves-light btn">سوال بعد</a>\n                                            </div>\n                                        </div>\n                                    </div>                '),submitAndGetNextQuestion(!0)}),0!=lastState&&-1!=lastState||1!=currentState||(document.getElementById("timerCaption").innerHTML="آزمون به پایان رسیده است",$.ajax({url:"https://amirnaderi.ir/exammer/getScore.php",type:"POST",data:{id:id},success:function(e){console.log(e);let t=parseInt(e.total||0),n=parseInt(e.correct||0),i=(parseInt(e.wrong||0),e.uid,0);i=parseInt(parseFloat(n/t*20))||0,document.getElementById("timer").innerHTML=i+"نمره شما: "}}),$("#questionCard").children().animate({height:"hide"}))),1==currentState)clearInterval(window.x);else{let u;-1==currentState?(document.getElementById("timerCaption").innerHTML="مانده تا شروع آزمون",u=c-window.now):0==currentState&&(u=c+d-window.now);var e=Math.floor(u/864e5),t=Math.floor(u%864e5/36e5),n=Math.floor(u%36e5/6e4),i=Math.floor(u%6e4/1e3),o=" روز و ",s=" ساعت و ",a=" دقیقه و ",r=" ثانیه";0==e?(o="",0==t?(s="",0==n?(a="",r=0==i?"":toPersianNum(i)+r):(r=toPersianNum(i)+r,a=toPersianNum(n)+a)):(r=toPersianNum(i)+r,a=toPersianNum(n)+a,s=toPersianNum(t)+s)):(r=toPersianNum(i)+r,a=toPersianNum(n)+a,s=toPersianNum(t)+s,o=toPersianNum(e)+o),document.getElementById("timer").innerHTML=o+s+a+r}lastState=currentState}}$(document).ready(()=>{$("#page-loading").addClass("loaded"),$.ajax({url:"https://amirnaderi.ir/exammer/time.php",type:"POST",data:{id:id},success:function(e){window.examInfo=JSON.parse(e),QuestionsNumber=window.examInfo.remainingQuestions.C,solvedQuestionsNumber=QuestionsNumber-window.examInfo.remainingQuestions.R,updateProgressBar()}}),window.x=setInterval(function(){window.now?window.now+=1e3:window.now=getNow(),handleUI()},1e3),$(document).on("click",".choice",function(){let e=$(this).data("selected");$(".choice").removeClass("selected"),$(".choice").data("selected",!1),$(".choice").blur(),selectedChoiceID=null,!0!==e&&($(this).addClass("selected"),$(this).data("selected",!0),selectedChoiceID=$(this).attr("cid"))})});